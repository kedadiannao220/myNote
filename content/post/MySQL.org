#+TITLE: MySQL
#+DATE: 2017-04-27T22:43:06+08:00
#+PUBLISHDATE: 2017-04-27T22:43:06+08:00
#+DRAFT: nil
#+TAGS: mysql
#+DESCRIPTION: Short description

* MySql学习
** 启动相关
#+BEGIN_SRC shell
/etc/init.d/mysqld start
/etc/init.d/mysqld stop
/etc/init.d/mysqld restart

service mysqld restart
service mysqld stop
service mysqld start
#+END_SRC
** 其他命令
#+BEGIN_SRC shell
mysql -uoot -pP@ssw0rd hf-csa -default-character-set=utf8 < db_qdn672.sql
#+END_SRC
** Mysql Dump
*** dump数据库
#+BEGIN_SRC shell
mysqldump -uroot -p hf-csa > hf-csa.sql
#+END_SRC
*** 只dump数据库表结构（--no-data -d）
#+BEGIN_SRC shell
mysqldump -uroot -p --no-data --add-drop-table hf-csa > hf-csa.sql
mysqldump -uroot -p -d --add-drop-table hf-csa > hf-csa.sql
#+END_SRC
*** dump数据库表结构排除某些表
#+BEGIN_SRC shell
mysqldump -uroot -p --no-data --add-drop-table hf-csa --ignore-table=hf-csa.ACT_GET_PROPERTY > hf-csa.sql
#+END_SRC
*** dump数据库某张表，表中间以空格分隔
#+BEGIN_SRC shell
mysqldump -uroot -p --no-data hf-csa SRV_INFO SRV_BP_APP_INFO > hf-csa.sql
#+END_SRC
*** dump数据库带注释的表结构
#+BEGIN_SRC shell
mysqldump -uroot -p --no-data --comments hf-csa SRV_INFO SRV_BP_APP_INFO > hf-csa.sql
#+END_SRC
*** reload dump File
#+BEGIN_SRC shell
shell> mysql hf-csa < hf-csa.sql
shell> mysql -e "source hf-csa.sql" hf-csa
mysql> use `hf-csa`;
mysql> source hf-csa.sql 
#+END_SRC
** INFOMATION_SCHEMA
#+BEGIN_SRC sql
SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_SCHEMA = 'hf-csa'; // 查询hf-csa下所有表的列
SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'hf-csa'; // 查询hf-csa下所有的表
#+END_SRC

#+BEGIN_SRC  sql
 SHOW FULL COLUMNS FROM table_name;                          #查看mysql某表当中的列字段，包括列的character
 SHOW TABLE STATUS where name like 'SRV_BP_APP_NODE_VER';    # 查看某表的状态

#+END_SRC

** 语法相关
*** LEFT JOIN，RIGHT JOIN,  INNER JOIN
- LEFT JOIN：以左边的表为基准显示查询结果
- RIGHT JOIN：以右边的表为基准显示查询结果
- INNER JOIN：只显示符合条件的查询结果
#+BEGIN_SRC shell
SELECT ip.IP_ADDRESS,ip.ID,unit.NAME FROM SRV_BP_DEV_IP ip LEFT JOIN SRV_BP_DEV dev ON ip.SRV_BP_DEV_ID = dev.ID
  LEFT JOIN SRV_BP_APP_DP_UNIT unit ON dev.SRV_BP_APP_DP_UNIT_ID = unit.ID WHERE
  ip.SRV_INFO_ID = dev.SRV_INFO_ID AND dev.SRV_INFO_ID = unit.SRV_INFO_ID AND ip.SRV_INFO_ID = '9ecbd34c-3ed6-4e61-8d11-0ba526e9ca98';
#+END_SRC
** 问题列表
*** mysql的一些运维命令
#+BEGIN_SRC shell
# 查看mysql的端口监听情况
netstate -nlt | grep 3306
lsof -i:3306
# 查看mysql的进程，同时可以看到mysql的一些文件位置
ps ax | grep mysqld 
#+END_SRC
*** ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)
#+BEGIN_SRC mysql
-- 进入安全模式
➜  ~ mysqld_safe --skip-grant-tables &

-- 直接无密码进入
➜  ~ mysql -uroot

-- 选择mysql
mysql> use mysql;

-- 修改密码
mysql> update user set password=PASSWORD("yunjikeji") where User = 'root';

-- flush 生效
mysql> flush privileges;

-- 再次用密码尝试登陆
➜  ~ mysql -uroot -p
#+END_SRC
*** Incorrect definition of table performance_schema.events_waits_current: expected column 'NESTING_EVEN
数据库结构错误，导致mysql启动异常
#+BEGIN_SRC shell
➜  ~ mysql_upgrade -u root -p
#+END_SRC
