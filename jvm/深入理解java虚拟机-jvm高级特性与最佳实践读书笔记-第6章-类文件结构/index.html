<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.20" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> &middot; My New Hugo Site</title>

  
  <link rel="stylesheet" href="http://kedadiannao220.github.io/css/print.css" media="print">
  <link rel="stylesheet" href="http://kedadiannao220.github.io/css/poole.css">
  <link rel="stylesheet" href="http://kedadiannao220.github.io/css/syntax.css">
  <link rel="stylesheet" href="http://kedadiannao220.github.io/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="My New Hugo Site" />
</head>

  <body class=" ">
  <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://kedadiannao220.github.io/"><h1>My New Hugo Site</h1></a>
      <p class="lead">
      An elegant open source and mobile first theme for <a href="http://hugo.spf13.com">hugo</a> made by <a href="http://twitter.com/mdo">@mdo</a>. Originally made for Jekyll.
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="http://kedadiannao220.github.io/">Home</a> </li>
      
    </ul>

    <p>&copy; 2017. All rights reserved. </p>
  </div>
</div>

    <div class="content container">
    <div class="post">
  <h1></h1>
  <span class="post-date">Mon, Jan 1, 0001</span>
  

<h1 id="第6章-类文件结构">第6章 类文件结构</h1>

<h2 id="6-1-概述">6.1 概述</h2>

<ul>
<li>代码编译的结果从本地机器码转变为字节码，是存储格式发展的一小步，却是编程语言发展的一大步</li>
<li>二进制本地机器码不再是唯一的选择</li>
</ul>

<h2 id="6-2-无关性基石">6.2 无关性基石</h2>

<ul>
<li>一次编写，到处运行</li>
<li>JVM通过JSR-292实现了对其他语言在jvm上面运行，像Clojure、Groovy、JRuby、Jython、Scala等；通过对应语言的编译器，将代码都编译成Class文件</li>
</ul>

<h2 id="6-3-class类文件结构">6.3 Class类文件结构</h2>

<ul>
<li>Class文件是一组以8位字节为基础单位的二进制流</li>
<li>Class文件结构采用一种类似于C语言结构体的伪结构来存储数据，有两种数据类型：无符号和表</li>
<li>无符号类型属于基本数据类型，以u1、u2、u4、u8来代表1个字节、2个字节、4个字节、8个字节的无符号数，用于描述数字，索引引用、数量值或者UTF-8编码构成字符串等</li>
<li>表是由多个无符号或者其他表作为数据项构成的复合数据类型，表一般以~info结尾~，用于描述层次关系的复合结构数据，整个Class文件就是一张表</li>
</ul>

<h3 id="6-3-1-魔数与class文件的版本">6.3.1 魔数与Class文件的版本</h3>

<ul>
<li>每个Class文件的头4个字节称为魔数，唯一作用是确定这个文件是否被虚拟机接受的Class文件</li>
<li>文件的扩展名称可以随意改动，基于安全方面的考虑采用了魔数</li>
<li>vim打开.class文件，输入:%!xxd即可转换为十六进制</li>
<li>4个字节后面存储的是Class文件的版本号，即0xcafebabe</li>
<li>第5、6个字节是次版本号 0x0000</li>
<li>第7、8个字节是主版本号 0x0033</li>
</ul>

<pre><code class="language-shell">00000000: cafe babe 0000 0033 002d 0a00 0700 2609
</code></pre>

<h3 id="6-3-2-常量池">6.3.2 常量池</h3>

<ul>
<li>紧接着主次版本号之后的是常量池入口，常量池是</li>
<li>占用Class文件最多的资源仓库，</li>
<li>占用Class文件空间最大的数据项目，</li>
<li>与其他项目关联最多的数据类型，</li>
<li>Class文件当中第一个出现的表类型数据项目</li>
<li>由于常量池当中常量的数量无法固定，所以放置一项u2类型数据</li>
<li>常量池容量计数值从1开始，而不是从0开始</li>
<li>常量池当中存放大类的常量：字面量和符号引用</li>
<li>字面量(literal)与Java语言的常量概念接近，final声明或者字符串等</li>
<li>符号引用(symbolic
References)类似于编译原理方面的概念，包括下面三类常量:类和接口的全限定名、字段的名称和描述符</li>
</ul>

<h3 id="6-3-3-访问标志">6.3.3 访问标志</h3>

<ul>
<li>两个字节来代表，用于记录访问标志是public、final、注解、枚举等</li>
</ul>

<h3 id="6-3-4-类索引-父类索引与接口索引集合">6.3.4 类索引、父类索引与接口索引集合</h3>

<ul>
<li>类索引和父类索引是u2类型的数据、接口索引是u2类型数据的集合</li>
<li>因为对象都继承于Object，那么所有Java类的父类索引都不为0</li>
</ul>

<h3 id="6-3-5-字段表集合">6.3.5 字段表集合</h3>

<ul>
<li>用于描述接口或者类中声明的变量</li>
<li>字段表包括访问标志、名称索引、描述符索引、属性表</li>
</ul>

<h3 id="6-3-6-方法表集合">6.3.6 方法表集合</h3>

<ul>
<li>方法表用于描述类当中的方法，与字段表的结构一样，包括访问标志、名称索引、描述符索引、属性表集合几项</li>
<li>方法当中的代码被存放在方法属性表集合当中的一个&rdquo;CODE&rdquo;属性里面</li>
</ul>

<h3 id="6-3-7-属性表集合">6.3.7 属性表集合</h3>

<ul>
<li>Exception、final声明的常量值、方法里面的代码(CODE)等</li>
</ul>

<h2 id="6-4-字节码指令简介">6.4 字节码指令简介</h2>

<ul>
<li>jvm有一套字节码转换指定，比如说加法指令：iadd、ladd、fadd、dadd等</li>
<li>这些指令包括：加载和存储指令、运算指令、类转换指令、对象创建与访问指令、操作数栈管理指令、方法调用和返回指令、异常处理指令、同步指令</li>
</ul>

<h2 id="6-5-公有设计和私有实现">6.5 公有设计和私有实现</h2>

<ul>
<li>jvm怎么可以知道方法是私有还是公有的呢？</li>
<li>两种方式实现：</li>
<li>1.  将代码在加载或执行时翻译成另外一种虚拟机的指令集</li>
<li>1.  将代码在加载或执行时翻译成宿主机CPU的本地指令集（JIT代码生成技术）</li>
</ul>

<h2 id="6-6-class文件结构的发展">6.6 Class文件结构的发展</h2>

<ul>
<li>Java虚拟机规范第1版本以来，Class文件结构一直都比较稳定</li>
<li>在第2版本当中添加了一些访问标志等属性</li>
</ul>

<h2 id="6-7-本章小结">6.7 本章小结</h2>

<ul>
<li>Class文件结构是怎么样的</li>
<li>字节码指令的介绍</li>
<li>虚拟机怎么解释字节码</li>
</ul>

</div>


    </div>

    
  </body>
</html>